@model IEnumerable<Site.Models.UploadFileVm>

@{
    ViewBag.Title = "Upload de Arquivos";
}

@section css
{
    <link href="@Url.Content("~/Content/css/bootstrap-theme.min.css")" rel="stylesheet" />
    <link href="@Url.Content("~/Content/js/fileUpload/css/jquery.fileupload.css")" rel="stylesheet" />
}

@using (Html.BeginForm("", "controler", FormMethod.Post, new { @class = "form-horizontal bucket-form", id = "frm_InserirArquivo" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <fieldset>
        <legend>Arquivos</legend>

        <div class="form-group">

            <span class="btn btn-success fileinput-button">
                <i class="glyphicon glyphicon-plus"></i>
                <span>Add arquivo...</span>
                <input id="fileupload" type="file" name="files[]">
            </span>
            <br />
            @*<div class="progress">
                <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
                    <span class="sr-only">0% complete</span>
                </div>
            </div>*@
        </div>
    </fieldset>

    if (TempData["Mensagem"] != null)
    {
        if (TempData["Mensagem"].ToString().Contains("SUCESSO"))
        {
            <div class="alert alert-success" role="alert">
                <a href="#" class="alert-link">@TempData["Mensagem"].ToString().Replace("[SUCESSO]", "")</a>
            </div>
        }

        if (TempData["Mensagem"].ToString().Contains("ERRO"))
        {
            <div class="alert alert-danger" role="alert">
                <a href="#" class="alert-link">@TempData["Mensagem"].ToString().Replace("[ERRO]", "")</a>
            </div>
        }

        if (TempData["Mensagem"].ToString().Contains("AVISO"))
        {
            <div class="alert alert-info" role="alert">
                <a href="#" class="alert-link">@TempData["Mensagem"].ToString().Replace("[AVISO]", "")</a>
            </div>
        }
    }

    <div>
        @if (TempData["TotalRegistro"] != null)
        {
            <span>Total de Registros no Arquivo:</span> @TempData["TotalRegistro"]
        }
        else
        {
            <span></span>
        }

        @if (Model != null)
        {
            <span>Total de Registros Cadastrados:</span> @Model.Count()
        }
        else
        {
            <span></span>
        }
    </div>
    if (Model != null && Model.Any())
    {
        <div class="table-responsive">
            <table id="table-upload" class="table table-bordered" data-filter="#filter" data-filter-text-only="true" data-page-size="5">
                <thead>
                    <tr>
                        <th data-toggle="true">
                            Comprador
                        </th>
                        <th>
                            Descrição
                        </th>
                        <th>
                            Preco Unitário
                        </th>
                        <th>
                            Quantidade
                        </th>
                        <th>
                            Endereço
                        </th>
                        <th>
                            Fornecedor
                        </th>
                        <th>
                            Validado
                        </th>
                        <th>
                            DataCriacao
                        </th>
                        @*<th data-toggle="true"></th>*@
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td scope="row">@item.Comprador</td>
                            <td data-value="">
                                @item.Descricao
                            </td>
                            <td data-value="">
                                @item.PrecoUnitario
                            </td>
                            <td data-value="">
                                @item.Quantidade
                            </td>
                            <td data-value="">
                                @item.Endereco
                            </td>
                            <td data-value="">
                                @item.Fornecedor
                            </td>
                            <td data-value="">
                                @if (item.Validado == true)
                                {
                                    <span>Sim</span>
                                }
                                else
                                {
                                    <span>Não</span>
                                }
                            </td>
                            <td data-value="">
                                @item.DataCriacao
                            </td>

                            @*<td data-value="78025368997" class="btn-group" style="width: 100%">
                                    <a target="_blank" href="~/Arquivo/Upload/Importacao/Conferencia/@item.Comprador" class="btn btn-info" id="btnVisualizar">
                                        Visualizar
                                    </a>
                                </td>*@
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="8">
                            <div class="pagination pagination-centered"></div>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    }
}

@section scripts
{
    <script src="@Url.Content("~/Content/js/fileUpload/js/vendor/jquery.ui.widget.js")"></script>
    <script src="@Url.Content("~/Content/js/fileUpload/js/jquery.fileupload.js")"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            var count = 1;

            $('#fileupload').fileupload({
                dataType: 'json',
                url: '/Home/UploadFiles',
                autoUpload: true,
                done: function (e, data) {
                    //$('.file_name').html(data.result.name);
                    //$('.file_type').html(data.result.type);
                    //$('.file_size').html(data.result.size);
                    if (count == data.originalFiles.length) {
                        location.reload();
                    }
                    count++;
                }
            }).on('fileuploadprogressall', function (e, data) {
                var progress = parseInt(data.loaded / data.total * 100, 10);
                $('.progress .progress-bar').css('width', progress + '%');
            });
        });
    </script>
}
